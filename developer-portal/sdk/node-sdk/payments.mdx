---
id: payments
title: Payments
---

import { Information, Link } from '../../../components';

# Payments

You can find a list of request body parameters and possible outcomes <Link to="https://api-reference.checkout.com/#tag/Payments">here</Link>.

## Request a card payment with a card token

The card token is generated by on of the Front End integration options like <Link to="https://docs.checkout.com/docs/frames">Checkout.Frames</Link> or one of the <Link to="https://docs.checkout.com/docs/sdks#section-mobile-sdk-libraries">Mobile SDKs</Link>. Keep in mind that this token expires in 15 minutes, and it's a single time use token.

```js
const payment = await cko.payments.request({
	source: {
		// type:"token" is inferred
		token: 'tok_bzi43qc6jeee5mmnfo4gnsnera',
	},
	customer: {
		email: 'user@email.com',
		name: 'James Bond',
	},
	currency: 'EUR',
	amount: 1000, // cents
	reference: 'ORDER123',
});
```

## Request a card payment with a full card details

<Information type="warning">
	You need to have a high level of PCI Compliance (SAQ-D) to be able to send requests with full card details. Note that
	unless this payment option is enabled on your account by Checkout.com, the request will fail. Contact you account
	manager to request access for this payment interaction.
</Information>

```js
const payment = await cko.payments.request({
	source: {
		// type:"card" is inferred
		number: '4242424242424242',
		expiry_month: 6,
		expiry_year: 2029,
		cvv: '100',
	},
	customer: {
		email: 'user@email.com',
		name: 'James Bond',
	},
	currency: 'EUR',
	amount: 1000, // cents
	reference: 'ORDER123',
});
```

## Request a card payment with an existing card

After you perform at least one successful payment for a customer, Checkout.com will return a source.id. This id does not expire, so it can be used perform payments without needing the customer to enter the card details again.

```js
const payment = await cko.payments.request({
	source: {
		// type:"id" is inferred
		id: 'src_vg3tm54ndfbefotjlmgrrvbxli',
	},
	customer: {
		email: 'user@email.com',
		name: 'James Bond',
	},
	currency: 'EUR',
	amount: 1000, // cents
	reference: 'ORDER123',
});
```

## Request a card payment with an existing customer

After you perform at least one successful payment for a customer, Checkout.com will return a customer.id. This id can be used perform payments without needing the customer to enter the card details again.

```js
const payment = await cko.payments.request({
	source: {
		// type:"customer" is inferred
		id: 'cus_6artgoevd77u7ojah2wled32sa',
	},
	currency: 'EUR',
	amount: 1000, // cents
	reference: 'ORDER123',
});
```

## Request a payment for a local payment method

The <Link to="https://api-reference.checkout.com/">API Reference</Link> contains a list of local payment options that you can use, as well as the other information required in the payment source (if required)

This is an example of a payment request for Sofort:

```js
const response = await cko.payments.request({
	source: {
		type: 'sofort',
	},
	currency: 'EUR', // Sofort only works with EUR
	amount: 1000,
});
```

As you can see from the <Link to="https://api-reference.checkout.com/">API Reference</Link> this request is meant to return a redirection URL, so you can let the customer complete the transaction on the local payment's website. Normally a successful response would look like this:

```json
{
	"id": "pay_y3gars76cvrudairph27ekzpvm",
	"status": "Pending",
	"customer": {
		"id": "cus_zbsnutwm2hoevnxnyj6o26sibe"
	},
	"_links": {
		"self": {
			"href": "https://api.sandbox.checkout.com/payments/pay_y3gars76cvrudairph27ekzpvm"
		},
		"redirect": {
			"href": "https://sandbox.checkout.com/LP.Core/api/payment/191952"
		}
	}
}
```

To make it easier to access the redirection URL, instead of accessing it as response.\_links.redirect.href the response body is appended with a parameter called redirectLink by the SDK, so the same URL will be accessible as response.redirectLink

## Request a 3D Secure payment

You have the ability to request 3DS in a payment request. The request body is similar to normal card payments, but with some additional parameters. <Link to="https://docs.checkout.com/docs/3d-secure-payments">Read more about 3DS</Link>

```js
const payment = await cko.payments.request({
	source: {
		// type:"token" is inferred
		token: 'tok_bzi43qc6jeee5mmnfo4gnsnera',
	},
	'3ds': {
		enabled: true,
	},
	customer: {
		email: 'user@email.com',
		name: 'James Bond',
	},
	currency: 'EUR',
	amount: 1000, // cents
	reference: 'ORDER123',
});
```

Similar to local payment options, 3D Secure payments will return a redirection URL. Here is an example of a 3DS response:

```json
{
	"id": "pay_krq2q22lblsevfkay2gfyvatta",
	"status": "Pending",
	"customer": {
		"id": "cus_c5c7d5f4avnehbhhgmnkdadkdu"
	},
	"3ds": {
		"downgraded": false,
		"enrolled": "Y"
	},
	"_links": {
		"self": {
			"href": "https://api.sandbox.checkout.com/payments/pay_krq2q22lblsevfkay2gfyvatta"
		},
		"redirect": {
			"href": "https://3ds2-sandbox.ckotech.co/interceptor/3ds_dr6us33uu57utjwh7yl5szcgqy"
		}
	}
}
```

To make it easier to access the redirection URL, instead of accessing it as response.\_links.redirect.href the response body is appended with a parameter called redirectLink by the SDK, so the same URL will be accessible as response.redirectLink

## Handle card payment responses

Payment requests are influenced by risk rules so you can have situations where a card payment is requested without 3D Secure, but upgraded by a risk rule, resulting in a 3D Secure response. You are free to handle the response in any way you want, but bellow you have a good example for a starting point:

```js
try {
    const payment = await cko.payments.request({...});

    if (payment.status === 'Pending') {
      // The payment is 3DS. Redirect the customer to payment.redirectLink
    } else if (approved == true && risk.flagged == false) {
      // The payment was successful and not flagged by any risk rule
    } else if (approved == true && risk.flagged == true) {
      // The payment was successful but it was flagged by a risk rule; this means you have to manually decide if you want to capture it or void it
    } else if (approved == false) {
      // the payment was declined
    }

} catch (error) {
    console.log(error.name);
}
```

## Get payment details

```js
const details = await cko.payments.get('pay_je5hbbb4u3oe7k4u3lbwlu3zkq'); // or with session id sid_XX
```

## Get payment actions

```js
const actions = await cko.payments.getActions('pay_juevt3h5mcjulir2t5g3wfug6u');
```

## Capture a payment

```js
const payment = await cko.payments.capture(paymentId, {
	reference: 'CAPTURE-REF',
}); // you can also pass the idempotency key as the third argument
```

## Refund a payment

```js
const payment = await cko.payments.refund(paymentId, {
	amount: 50,
	reference: 'REFUND-REF',
}); // you can also pass the idempotency key as the third argument
```

## Void a payment

```js
const payment = await cko.payments.void(paymentId, {
	reference: 'VOID-REF',
}); // you can also pass the idempotency key as the third argument
```
